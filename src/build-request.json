{
  "kind": "build_request",
  "title": "Fix IC0508 canister rejection error in predictOutbreakRisk backend call",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-101",
      "text": "Debug and fix the IC0508 canister rejection error occurring when the GovernmentDataPanel component calls the backend predictOutbreakRisk function, ensuring the HTTP call completes successfully without 'canister_id', '4ctyt-niaaa-aaaal-auroq-cai', 'non_replicated_rejection', or 'reject_code 5' errors",
      "target": "both",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "Risk Calculation Failed",
          "The replica returned a rejection error: Request ID: 6632e119afcbb738d570b59585001690402be9fc886dcee62f330bae970ff7ef Reject code: 5 Reject text: Canister 4ctyt-niaaa-aaaal-auroq-cai is stopped Error code: IC0508 Call context: Canister ID: 4ctyt-niaaa-aaaal-auroq-cai Method name: predictOutbreakRisk"
        ]
      },
      "acceptanceCriteria": [
        "The 'Update & Recalculate Risk' button in GovernmentDataPanel successfully calls backend predictOutbreakRisk without IC0508 errors",
        "Risk calculation completes and returns valid outbreak probability percentage",
        "All dashboard visualizations (RiskGauge, DiseaseClassification, WardHeatmap, InterventionPriority) update correctly after risk calculation",
        "No canister rejection errors appear in the UI or browser console",
        "Alert history entry is created successfully with calculated risk outputs"
      ]
    },
    {
      "id": "REQ-102",
      "text": "Verify the backend predictOutbreakRisk function in backend/main.mo handles all input parameters correctly, validates numeric ranges, implements the 7-day moving average calculation properly, and returns a valid response structure without throwing runtime errors",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-latest"
        ]
      },
      "acceptanceCriteria": [
        "Backend function accepts rainfall, humidity, turbidity, and bacteria index parameters",
        "7-day moving average calculation executes without errors",
        "Weighted risk formula (30% rainfall, 25% turbidity, 25% bacteria, 20% humidity) calculates correctly",
        "Function returns normalized risk percentage (0-100%) and risk category (Low/Medium/High)",
        "No runtime exceptions or canister stopping errors occur during calculation"
      ]
    },
    {
      "id": "REQ-103",
      "text": "Add comprehensive error handling and logging to the GovernmentDataPanel component's handleUpdateRisk function to catch and display specific backend call failures, canister errors, or network issues with user-friendly error messages in toast notifications",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-latest"
        ]
      },
      "acceptanceCriteria": [
        "Try-catch block wraps the backend predictOutbreakRisk call",
        "Specific error types are identified: canister rejection, network failure, validation errors",
        "Error messages display the actual failure reason from the backend response",
        "Console logs include full error details for debugging",
        "User sees actionable error message in UI (not generic 'Risk Calculation Failed')"
      ]
    }
  ],
  "constraints": [
    "Do not modify any other components, files, or functionality beyond the risk calculation error fix",
    "Maintain all existing GovernmentDataPanel UI elements and form fields",
    "Preserve the current EmailJS integration and alert history storage logic",
    "Keep all role-based access control and dashboard view logic unchanged",
    "Do not alter the visual styling, color theme, or component layout"
  ],
  "nonGoals": [
    "Adding new dashboard features or visualization components",
    "Modifying the role selection system or user authentication",
    "Changing the EmailJS configuration or alert email logic",
    "Updating the UI theme, colors, or styling",
    "Refactoring unrelated components or utility functions",
    "Adding new ward data fields or calculation parameters"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}